import { getBlogPostBySlug, getCategories } from '../../lib/supabase';

// Dinamik rota parametresini al
const { slug } = Astro.params;

// İlgili blog yazısını getir
const post = await getBlogPostBySlug(slug);

// Blog yazısı bulunamadıysa hata sayfasına yönlendir
if (!post) {
  return Astro.redirect('/404');
}

// Kategori bilgisini alalım
const categories = await getCategories();
const category = categories.find(cat => cat.id === post.category_id);

const pageTitle = post.title;

<html lang="tr">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{pageTitle}</title>
		<meta name="description" content={post.meta_description} />
		<meta name="keywords" content={post.keywords ? post.keywords.join(', ') : ''} />
		<style>
			body {
				font-family: Arial, sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 20px;
				line-height: 1.6;
			}
			header {
				border-bottom: 1px solid #ddd;
				margin-bottom: 20px;
				padding-bottom: 10px;
			}
			.nav-links {
				display: flex;
				gap: 15px;
				margin-bottom: 20px;
			}
			.post-header {
				margin-bottom: 30px;
			}
			.post-title {
				margin-bottom: 10px;
				font-size: 2rem;
			}
			.post-meta {
				display: flex;
				justify-content: space-between;
				color: #666;
				font-size: 0.9rem;
				margin-bottom: 20px;
			}
			.post-category {
				background-color: #e8f5e9;
				display: inline-block;
				padding: 3px 8px;
				border-radius: 4px;
				margin-right: 10px;
			}
			.post-content {
				margin-bottom: 30px;
			}
			.featured-image {
				width: 100%;
				max-height: 400px;
				object-fit: cover;
				border-radius: 4px;
				margin-bottom: 20px;
			}
			.faq-section {
				margin-top: 40px;
				background-color: #f4f4f4;
				padding: 20px;
				border-radius: 4px;
			}
			.faq-item {
				margin-bottom: 20px;
			}
			.faq-question {
				font-weight: bold;
				margin-bottom: 5px;
			}
			footer {
				margin-top: 30px;
				border-top: 1px solid #ddd;
				padding-top: 10px;
				font-size: 0.9em;
				color: #666;
			}
		</style>
	</head>
	<body>
		<header>
			<h1>Blog</h1>
			<div class="nav-links">
				<a href="/">Ana Sayfa</a>
				<a href="/kategoriler">Kategoriler</a>
				<a href="/hakkinda">Hakkında</a>
			</div>
		</header>
		
		<main>
			<article>
				<div class="post-header">
					<h1 class="post-title">{post.title}</h1>
					<div class="post-meta">
						<div>
							{category && (
								<a href={`/kategori/${category.slug}`} class="post-category">
									{category.name}
								</a>
							)}
							<span>Tarih: {new Date(post.created_at).toLocaleDateString('tr-TR')}</span>
						</div>
					</div>
					
					{post.featured_image && (
						<img 
							src={post.featured_image} 
							alt={post.title} 
							class="featured-image"
						/>
					)}
				</div>
				
				<div class="post-content">
					{/* İçerik HTML olarak işlenebilir */}
					<div set:html={post.content} />
				</div>
				
				{post.faq && post.faq.length > 0 && (
					<div class="faq-section">
						<h2>Sık Sorulan Sorular</h2>
						{post.faq.map((item) => (
							<div class="faq-item">
								<div class="faq-question">{item.question}</div>
								<div class="faq-answer">{item.answer}</div>
							</div>
						))}
					</div>
				)}
			</article>
		</main>
		
		<footer>
			<p>© {new Date().getFullYear()} Coolify Test Projesi</p>
		</footer>
	</body>
</html> 